package org.apache.gdr.ext.util;

import org.apache.gdr.common.exception.GdrException;
import org.apache.gdr.common.schema.dataset.AbDataDef;
import junit.framework.Assert;
import org.apache.hadoop.hive.ql.parse.ParseException;
import org.apache.hadoop.hive.ql.parse.SemanticException;
import org.junit.Test;

public class TestDmlFromDDL {
    @Test
    public void testAbvroDDL() throws SemanticException, ParseException, GdrException {
        String command = "CREATE TABLE stg_odr_cps_dsn_log_w_ir\n"
                + "ROW FORMAT SERDE 'AbvroSerDe'"
                + "STORED AS\n"
                + "  INPUTFORMAT 'org.apache.gdr.mapred.AbAsAvroInputFormat'\n"
                + "  OUTPUTFORMAT 'org.apache.gdr.mapred.AvroAsAbOutputFormat'\n"
                + "LOCATION 'igfs://igfs@ignite-d1:10500/data/dw_cps_dsn_log'\n"
                + "TBLPROPERTIES (\n"
                + "  'com.ebay.dss.dml.file' = '/dml/dw_cps_dsn_log.read.dml'\n"
                + ")";
        HiveTableDefinition ctd = new HiveTableDefinition(command);
        Assert.assertEquals(0, ctd.getCols().size());
    }

    @Test
    public void testTextDDL() throws SemanticException, ParseException, GdrException {
        String command = "CREATE EXTERNAL TABLE dw_users_info_n_w(user_regn_id decimal(6,0), user_id decimal(18,0), user_slctd_id string, user_sts_code decimal(3,0), user_confirm_code string, last_modfd timestamp, userid_last_chg timestamp, user_flags decimal(16,0), email string, hash_email binary, user_cntry_id decimal(10,0), uvdetail decimal(16,0), uvrating decimal(5,0), feedback_score decimal(18,0), user_site_id decimal(3,0), cobrand_prtnr_id decimal(9,0), blng_curncy_id decimal(3,0), equifax_sts string, user_sex_flag decimal(18,0), top_slr_lvl_code decimal(3,0), flagsex2 decimal(18,0), motors_seller_level decimal(8,0), mbyte_userid string, flagsex3 decimal(18,0), flagsex4 int, flagsex5 int, flagsex6 int, geo_pstl_code string, bbp_min_alwd_fdbk_score int, ebx_elgbl_slr_yn_id tinyint, ebx_qlfd_slr_yn_id tinyint, slr_ebx_optn_status_id tinyint, ebx_cs_frc_out_yn_id tinyint, ebx_cs_frc_in_yn_id tinyint, ebx_regstrd_user_yn_id tinyint, sdc_sys_user_yn_id tinyint, regstrd_slng_chnl_id tinyint, flagsex7 int, guest_ind string, pp_auto_linking_disabled_ind string, flagsex8 int, flagsex9 int, flagsex10 int, flagsex11 int, acct_type_cd decimal(4,0), flagsex12 decimal(18,0), addr1 string, addr2 string, flags01 int, addr2_used_yn_id tinyint, banner_prtnr_id decimal(9,0), cc_onfile_yn string, city string, comp string, dayphone string, equifax_attempts decimal(4,0), equifax_last_modfd_date timestamp, faxphone string, gender_mfu string, good_crd_yn string, nightphone string, pref_categ_interest1_id decimal(18,0), pref_categ_interest2_id decimal(18,0), pref_categ_interest3_id decimal(18,0), pref_categ_interest4_id decimal(18,0), pstl_code string, state string, top_slr_initiate_date timestamp, user_cre_date timestamp, user_cre_prd_id string, user_cre_week_id string, user_name string, user_ip_addr string, req_email_count decimal(10,0), last_modified_user_info timestamp, payment_type decimal(9,0), date_confirm timestamp, date_of_birth timestamp, site_personal_id string, eop_verify_stat decimal(4,0), eop_last_verify timestamp, last_banner_prtnr_id decimal(9,0), aol_master_id decimal(18,0), tax_id_application_date timestamp, tax_id_confirm_date timestamp, tax_status decimal(3,0), motors_seller_initiated_date date, linked_paypal_acct string, paypal_link_state decimal(2,0), verification_method decimal(3,0), verification_type_code decimal(8,0), verification_date date, cellphone string, anonymous_email_yn_flag_id tinyint, reg_test_grp_id smallint, busn_type_id tinyint, user_dsgntn_id tinyint, user_dsgntn_dt date, user_dsgntn_tm timestamp, ebx_pref_last_modfd_dt date, ebx_pref_last_modfd_tm timestamp, pri_user_id decimal(18,0), top_byr_gmb_score int, smsphone string, slr_pp_dflt_email string, slr_reg_ip_addr string, user_first_name string, user_last_name string, reg_initd_site_id decimal(4,0), reg_cmpltd_site_id decimal(4,0), syi_block_begin_dt date, syi_block_dt date, slr_block_rsn_type decimal(4,0), cs_force_bsns_dt date, cs_bsns_exmptn_dt date, exclude_ship_to_loc_modify_ts timestamp, hash_addr1 binary, hash_addr2 binary, hash_dayphone binary, hash_faxphone binary, hash_nightphone binary, hash_user_name binary, hash_user_ip_addr binary, hash_cellphone binary, hash_smsphone binary, hash_slr_pp_dflt_email binary, hash_user_first_name binary, hash_user_last_name binary, payment_type_last_mdfd_date timestamp, user_prfr_lang_cd_txt string, biz_entity_type_txt string, trade_rgstrtn_id string, reg_mchn_group_id decimal(38,0), dayphone_cntry_cd decimal(4,0), address_count decimal(9,0), paybox_country_id string, paybox_number string, cbt_sbscr_dt date, hash_initl_real_email binary)"
                + "ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'"
                + "WITH SERDEPROPERTIES ("
                + "  'line.delim' = '\n'," + "  'field.delim' = '\177'" + ")"
                + "STORED AS"
                + "  INPUTFORMAT 'org.apache.hadoop.mapred.TextInputFormat'"
                + "  OUTPUTFORMAT 'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'"
                + "LOCATION 'hdfs://ignite1-1-1794160.lvs02.dev.ebayc3.com:8020/data/dw_users_info_n_w'";
        //Log.info(hsp.getDML());
        String dmlStr = "record\n  decimal(\"\\u007f\") user_regn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") user_id = NULL(\"\\N\");\n  string(\"\\u007f\") user_slctd_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") user_sts_code = NULL(\"\\N\");\n  string(\"\\u007f\") user_confirm_code = NULL(\"\\N\");\n  datetime(\"\\u007f\") last_modfd = NULL(\"\\N\");\n  datetime(\"\\u007f\") userid_last_chg = NULL(\"\\N\");\n  decimal(\"\\u007f\") user_flags = NULL(\"\\N\");\n  string(\"\\u007f\") email = NULL(\"\\N\");\n  string(\"\\u007f\") hash_email = NULL(\"\\N\");\n  decimal(\"\\u007f\") user_cntry_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") uvdetail = NULL(\"\\N\");\n  decimal(\"\\u007f\") uvrating = NULL(\"\\N\");\n  decimal(\"\\u007f\") feedback_score = NULL(\"\\N\");\n  decimal(\"\\u007f\") user_site_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") cobrand_prtnr_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") blng_curncy_id = NULL(\"\\N\");\n  string(\"\\u007f\") equifax_sts = NULL(\"\\N\");\n  decimal(\"\\u007f\") user_sex_flag = NULL(\"\\N\");\n  decimal(\"\\u007f\") top_slr_lvl_code = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex2 = NULL(\"\\N\");\n  decimal(\"\\u007f\") motors_seller_level = NULL(\"\\N\");\n  string(\"\\u007f\") mbyte_userid = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex3 = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex4 = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex5 = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex6 = NULL(\"\\N\");\n  string(\"\\u007f\") geo_pstl_code = NULL(\"\\N\");\n  decimal(\"\\u007f\") bbp_min_alwd_fdbk_score = NULL(\"\\N\");\n  decimal(\"\\u007f\") ebx_elgbl_slr_yn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") ebx_qlfd_slr_yn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") slr_ebx_optn_status_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") ebx_cs_frc_out_yn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") ebx_cs_frc_in_yn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") ebx_regstrd_user_yn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") sdc_sys_user_yn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") regstrd_slng_chnl_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex7 = NULL(\"\\N\");\n  string(\"\\u007f\") guest_ind = NULL(\"\\N\");\n  string(\"\\u007f\") pp_auto_linking_disabled_ind = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex8 = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex9 = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex10 = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex11 = NULL(\"\\N\");\n  decimal(\"\\u007f\") acct_type_cd = NULL(\"\\N\");\n  decimal(\"\\u007f\") flagsex12 = NULL(\"\\N\");\n  string(\"\\u007f\") addr1 = NULL(\"\\N\");\n  string(\"\\u007f\") addr2 = NULL(\"\\N\");\n  decimal(\"\\u007f\") flags01 = NULL(\"\\N\");\n  decimal(\"\\u007f\") addr2_used_yn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") banner_prtnr_id = NULL(\"\\N\");\n  string(\"\\u007f\") cc_onfile_yn = NULL(\"\\N\");\n  string(\"\\u007f\") city = NULL(\"\\N\");\n  string(\"\\u007f\") comp = NULL(\"\\N\");\n  string(\"\\u007f\") dayphone = NULL(\"\\N\");\n  decimal(\"\\u007f\") equifax_attempts = NULL(\"\\N\");\n  datetime(\"\\u007f\") equifax_last_modfd_date = NULL(\"\\N\");\n  string(\"\\u007f\") faxphone = NULL(\"\\N\");\n  string(\"\\u007f\") gender_mfu = NULL(\"\\N\");\n  string(\"\\u007f\") good_crd_yn = NULL(\"\\N\");\n  string(\"\\u007f\") nightphone = NULL(\"\\N\");\n  decimal(\"\\u007f\") pref_categ_interest1_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") pref_categ_interest2_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") pref_categ_interest3_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") pref_categ_interest4_id = NULL(\"\\N\");\n  string(\"\\u007f\") pstl_code = NULL(\"\\N\");\n  string(\"\\u007f\") state = NULL(\"\\N\");\n  datetime(\"\\u007f\") top_slr_initiate_date = NULL(\"\\N\");\n  datetime(\"\\u007f\") user_cre_date = NULL(\"\\N\");\n  string(\"\\u007f\") user_cre_prd_id = NULL(\"\\N\");\n  string(\"\\u007f\") user_cre_week_id = NULL(\"\\N\");\n  string(\"\\u007f\") user_name = NULL(\"\\N\");\n  string(\"\\u007f\") user_ip_addr = NULL(\"\\N\");\n  decimal(\"\\u007f\") req_email_count = NULL(\"\\N\");\n  datetime(\"\\u007f\") last_modified_user_info = NULL(\"\\N\");\n  decimal(\"\\u007f\") payment_type = NULL(\"\\N\");\n  datetime(\"\\u007f\") date_confirm = NULL(\"\\N\");\n  datetime(\"\\u007f\") date_of_birth = NULL(\"\\N\");\n  string(\"\\u007f\") site_personal_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") eop_verify_stat = NULL(\"\\N\");\n  datetime(\"\\u007f\") eop_last_verify = NULL(\"\\N\");\n  decimal(\"\\u007f\") last_banner_prtnr_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") aol_master_id = NULL(\"\\N\");\n  datetime(\"\\u007f\") tax_id_application_date = NULL(\"\\N\");\n  datetime(\"\\u007f\") tax_id_confirm_date = NULL(\"\\N\");\n  decimal(\"\\u007f\") tax_status = NULL(\"\\N\");\n  date(\"\\u007f\") motors_seller_initiated_date = NULL(\"\\N\");\n  string(\"\\u007f\") linked_paypal_acct = NULL(\"\\N\");\n  decimal(\"\\u007f\") paypal_link_state = NULL(\"\\N\");\n  decimal(\"\\u007f\") verification_method = NULL(\"\\N\");\n  decimal(\"\\u007f\") verification_type_code = NULL(\"\\N\");\n  date(\"\\u007f\") verification_date = NULL(\"\\N\");\n  string(\"\\u007f\") cellphone = NULL(\"\\N\");\n  decimal(\"\\u007f\") anonymous_email_yn_flag_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") reg_test_grp_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") busn_type_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") user_dsgntn_id = NULL(\"\\N\");\n  date(\"\\u007f\") user_dsgntn_dt = NULL(\"\\N\");\n  datetime(\"\\u007f\") user_dsgntn_tm = NULL(\"\\N\");\n  date(\"\\u007f\") ebx_pref_last_modfd_dt = NULL(\"\\N\");\n  datetime(\"\\u007f\") ebx_pref_last_modfd_tm = NULL(\"\\N\");\n  decimal(\"\\u007f\") pri_user_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") top_byr_gmb_score = NULL(\"\\N\");\n  string(\"\\u007f\") smsphone = NULL(\"\\N\");\n  string(\"\\u007f\") slr_pp_dflt_email = NULL(\"\\N\");\n  string(\"\\u007f\") slr_reg_ip_addr = NULL(\"\\N\");\n  string(\"\\u007f\") user_first_name = NULL(\"\\N\");\n  string(\"\\u007f\") user_last_name = NULL(\"\\N\");\n  decimal(\"\\u007f\") reg_initd_site_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") reg_cmpltd_site_id = NULL(\"\\N\");\n  date(\"\\u007f\") syi_block_begin_dt = NULL(\"\\N\");\n  date(\"\\u007f\") syi_block_dt = NULL(\"\\N\");\n  decimal(\"\\u007f\") slr_block_rsn_type = NULL(\"\\N\");\n  date(\"\\u007f\") cs_force_bsns_dt = NULL(\"\\N\");\n  date(\"\\u007f\") cs_bsns_exmptn_dt = NULL(\"\\N\");\n  datetime(\"\\u007f\") exclude_ship_to_loc_modify_ts = NULL(\"\\N\");\n  string(\"\\u007f\") hash_addr1 = NULL(\"\\N\");\n  string(\"\\u007f\") hash_addr2 = NULL(\"\\N\");\n  string(\"\\u007f\") hash_dayphone = NULL(\"\\N\");\n  string(\"\\u007f\") hash_faxphone = NULL(\"\\N\");\n  string(\"\\u007f\") hash_nightphone = NULL(\"\\N\");\n  string(\"\\u007f\") hash_user_name = NULL(\"\\N\");\n  string(\"\\u007f\") hash_user_ip_addr = NULL(\"\\N\");\n  string(\"\\u007f\") hash_cellphone = NULL(\"\\N\");\n  string(\"\\u007f\") hash_smsphone = NULL(\"\\N\");\n  string(\"\\u007f\") hash_slr_pp_dflt_email = NULL(\"\\N\");\n  string(\"\\u007f\") hash_user_first_name = NULL(\"\\N\");\n  string(\"\\u007f\") hash_user_last_name = NULL(\"\\N\");\n  datetime(\"\\u007f\") payment_type_last_mdfd_date = NULL(\"\\N\");\n  string(\"\\u007f\") user_prfr_lang_cd_txt = NULL(\"\\N\");\n  string(\"\\u007f\") biz_entity_type_txt = NULL(\"\\N\");\n  string(\"\\u007f\") trade_rgstrtn_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") reg_mchn_group_id = NULL(\"\\N\");\n  decimal(\"\\u007f\") dayphone_cntry_cd = NULL(\"\\N\");\n  decimal(\"\\u007f\") address_count = NULL(\"\\N\");\n  string(\"\\u007f\") paybox_country_id = NULL(\"\\N\");\n  string(\"\\u007f\") paybox_number = NULL(\"\\N\");\n  date(\"\\u007f\") cbt_sbscr_dt = NULL(\"\\N\");\n  string(\"\\n\") hash_initl_real_email = NULL(\"\\N\");\nend\n";
        HiveTableDefinition ctd = new HiveTableDefinition(command);
        AbDataDef ab = AbDataDefBuilder.build(ctd);
        Assert.assertEquals(dmlStr, ab.getDmlStr());
    }
}
